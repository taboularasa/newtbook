<!doctype html>
<html>
  <head>
    <link href="../../../stylesheets/all-bb815f9b.css" rel="stylesheet" type="text/css" />
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>Blog Title - Virtual Inventory Location</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
  </head>
  <body>

      <h1>Virtual Inventory Location</h1>
    <div id="main" role="main">
      <p>I work on an application that sells Widgets. You as might know, a Widget can be a pretty serious investment. What you might not know is that for people who take Widgets seriously, choosing the right one can be <strong>very</strong> personal. Because of this reason, the widget application that I work on offers customers the chance to order a home Try-on kit. After supplying some collateral, we will send you a box of six widgets in various configurations. You have a week to live with them in your home. At the end of the trial period you simply keep the one that you love the most and send the rest back to us, postage paid in full both ways! If you happen to be in the market I highly recommend you give it a try!</p>

<p>Naturally, in order to offer this home try-on service we need to have a demo fleet of widgets and a robust inventory management system. We track all the widgets that exist in the warehouse, the factory and in every package that gets sent out for home try-on. One thing that we didn&#39;t track however was the aggregate of all the widget inventory thats currently out on demo. And that&#39;s what I was tasked with building today!</p>

<p>When Admin users needs to take stock of an inventory location, the Factory for example, they can expect to see something like this:</p>

<table><thead>
<tr>
<th style="text-align: left">Type</th>
<th style="text-align: left">Quantity</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">Blue widget</td>
<td style="text-align: left">340</td>
</tr>
<tr>
<td style="text-align: left">Green widget</td>
<td style="text-align: left">320</td>
</tr>
<tr>
<td style="text-align: left">Yellow widget</td>
<td style="text-align: left">42</td>
</tr>
<tr>
<td style="text-align: left">Red widget</td>
<td style="text-align: left">630</td>
</tr>
<tr>
<td style="text-align: left">Pink widget</td>
<td style="text-align: left">20</td>
</tr>
</tbody></table>

<p>This gives them a high level view of what Widgets might need to be transferred from another location. This has worked well up to this point but now the problem is our home try-on service is so popular we end up with a significant amount of inventory out in transit. This impacts our ability to forecast inventory needs for manufacturing. So one of our admin users requested that we provide a similar table that reports on the aggregate of all the try-on kits currently out in transit.</p>

<p>When I first designed this inventory system I made a decision that try-on kits should partially implement the interface of an inventory location. This made the flow of inventory in and out of Try-on kits very convenient. Reflecting on that  gave me the idea of creating a virtual inventory location. It would only need an interface that conforms to what is exposed by the views (since this is a read only use case) and a collection from which it could derive calculated properties:</p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></td><td class="code"><pre><span class="n">describe</span> <span class="no">KitsInventoryLocation</span> <span class="k">do</span>
  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">variant</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:variant</span><span class="p">)</span>
    <span class="n">kit_1</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="ss">:try_on_kit</span><span class="p">,</span> <span class="ss">state: </span><span class="s1">'shipped'</span><span class="p">)</span>
    <span class="n">kit_1</span><span class="p">.</span><span class="nf">save</span> <span class="ss">validate: </span><span class="kp">false</span>
    <span class="n">kit_1</span><span class="p">.</span><span class="nf">add_stock</span><span class="p">(</span><span class="n">variant</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">kit_1</span><span class="p">.</span><span class="nf">placements</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">variant_id: </span><span class="n">variant</span><span class="p">.</span><span class="nf">id</span><span class="p">)</span>

    <span class="n">kit_2</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="ss">:try_on_kit</span><span class="p">,</span> <span class="ss">state: </span><span class="s1">'shipped'</span><span class="p">)</span>
    <span class="n">kit_2</span><span class="p">.</span><span class="nf">save</span> <span class="ss">validate: </span><span class="kp">false</span>
    <span class="n">kit_2</span><span class="p">.</span><span class="nf">add_stock</span><span class="p">(</span><span class="n">variant</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">kit_2</span><span class="p">.</span><span class="nf">placements</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">variant_id: </span><span class="n">variant</span><span class="p">.</span><span class="nf">id</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">'#total_count_on_hand'</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">'returns a count of all the products in shipped kits'</span> <span class="k">do</span>
      <span class="n">kits_location</span> <span class="o">=</span> <span class="no">KitsInventoryLocation</span><span class="p">.</span><span class="nf">new</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">kits_location</span><span class="p">.</span><span class="nf">total_count_on_hand</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">'#inventory_items'</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">'returns an instance of MockInventoryItemCollection'</span> <span class="k">do</span>
      <span class="n">kits_location</span> <span class="o">=</span> <span class="no">KitsInventoryLocation</span><span class="p">.</span><span class="nf">new</span>

      <span class="n">expect</span><span class="p">(</span><span class="n">kits_location</span><span class="p">.</span><span class="nf">inventory_items</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">to</span> <span class="n">be_kind_of</span><span class="p">(</span><span class="no">MockInventoryItemCollection</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

<p>The implementation turned out like this:</p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">KitsLocation</span>
  <span class="kp">attr_accessor</span> <span class="ss">:kits</span>

  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">kits</span> <span class="o">=</span> <span class="no">WidgetKit</span><span class="p">.</span><span class="nf">shipped</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">name</span>
    <span class="s1">'All Try-on Kits'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">to_param</span>
    <span class="s1">'kits_location'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">total_count_on_hand</span>
    <span class="n">kits</span><span class="p">.</span><span class="nf">reduce</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="o">|</span> <span class="n">a</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="nf">total_count_on_hand</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">inventory_items</span>
    <span class="vi">@inventory_items</span> <span class="o">||=</span> <span class="no">MockInventoryItemCollection</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">group_by_variants</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">group_by_variants</span>
    <span class="vi">@group_by_variants</span> <span class="o">||=</span> <span class="n">kits</span><span class="p">.</span><span class="nf">flat_map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:placements</span><span class="p">).</span><span class="nf">group_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:variant</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

<p>Now I can mix this location in with all the others. In their controller:</p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Admin</span><span class="o">::</span><span class="no">InventoryLocationsController</span> <span class="o">&lt;</span> <span class="no">Admin</span><span class="o">::</span><span class="no">BaseController</span>
  <span class="n">helper_method</span> <span class="ss">:inventory_location</span><span class="p">,</span> <span class="ss">:inventory_locations</span>

  <span class="k">def</span> <span class="nf">index</span><span class="p">;</span> <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span><span class="p">;</span> <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">kits_location</span>
    <span class="vi">@kits_location</span> <span class="o">=</span> <span class="no">KitsLocation</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">inventory_location</span>
    <span class="vi">@inventory_location</span> <span class="o">||=</span> <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'kits_location'</span>
      <span class="n">kits_location</span>
    <span class="k">else</span>
      <span class="no">InventoryLocation</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">inventory_items</span>
    <span class="vi">@inventory_items</span> <span class="o">||=</span> <span class="n">inventory_location</span><span class="p">.</span><span class="nf">inventory_items</span><span class="p">.</span><span class="nf">active_items</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">inventory_locations</span>
    <span class="vi">@inventory_locations</span> <span class="o">||=</span>
      <span class="no">InventoryLocation</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="ss">:inventory_items</span><span class="p">).</span><span class="nf">all</span><span class="p">.</span><span class="nf">to_a</span> <span class="o">&lt;&lt;</span> <span class="n">kits_location</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

<p>And in their views. E.g. index:</p>
<div class="highlight html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre></td><td class="code"><pre><span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-bordered table-striped"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;thead&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Total count on hand<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;/thead&gt;</span>
  <span class="nt">&lt;tbody&gt;</span>
    <span class="err">&lt;</span>% inventory_locations.each do |location| %&gt;
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td&gt;</span><span class="err">&lt;</span>%= location.name %&gt;<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span><span class="err">&lt;</span>%= location.total_count_on_hand %&gt;<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">width=</span><span class="s">"200"</span><span class="nt">&gt;</span>
          <span class="err">&lt;</span>%= link_to "Show", admin_inventory_location_path(location), class: "btn btn-primary" %&gt;
        <span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
    <span class="err">&lt;</span>% end %&gt;
  <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</pre></td></tr></tbody></table>
</div>

<p>E.g. show:</p>
<div class="highlight html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-bordered table-striped"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th&gt;</span>Product<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>Variant<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>SKU<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>Quantity<span class="nt">&lt;/th&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
  <span class="err">&lt;</span>% @inventory_items.each do |item| %&gt;
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="err">&lt;</span>%= item.variant.product.name %&gt;<span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="err">&lt;</span>%= item.variant.name %&gt;<span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="err">&lt;</span>%= item.variant.sku %&gt;<span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="err">&lt;</span>%= item.count_on_hand_less_backorders %&gt;<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="err">&lt;</span>% end %&gt;
<span class="nt">&lt;/table&gt;</span>
</pre></td></tr></tbody></table>
</div>

<p><code>KitsInventoryLocation#total_count_on_hand</code> is used to show our virtual inventory location in a collection with real inventory locations, e.g. a index of inventory locations:</p>

<table><thead>
<tr>
<th style="text-align: left">Location</th>
<th style="text-align: left">Total Quantity</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">The Factory</td>
<td style="text-align: left">34,982</td>
</tr>
<tr>
<td style="text-align: left">The Warehouse</td>
<td style="text-align: left">80,6543</td>
</tr>
<tr>
<td style="text-align: left">All Try-on Kits</td>
<td style="text-align: left">113,486</td>
</tr>
</tbody></table>

<p><code>KitsInventoryLocation#inventory_items</code> is a collection of virtual inventory items. I needed a simple collection thats would accept a hash of inventory grouped by Widget type and build out <code>MockInventoryItem</code>s which represent the count. That&#39;s why we have that private method, <code>KitsLocation#group_by_variants</code></p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></td><td class="code"><pre><span class="n">describe</span> <span class="no">MockInventoryItemCollection</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s1">'#initialize'</span> <span class="k">do</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:variant</span><span class="p">)</span> <span class="p">{</span> <span class="n">create</span><span class="p">(</span><span class="ss">:variant</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:placement</span><span class="p">)</span> <span class="p">{</span> <span class="n">create</span><span class="p">(</span><span class="ss">:kit</span><span class="p">).</span><span class="nf">placements</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">variant_id: </span><span class="n">variant</span><span class="p">.</span><span class="nf">id</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:valid_argument</span><span class="p">)</span> <span class="p">{</span> <span class="p">{</span> <span class="n">variant</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="n">placement</span><span class="p">]</span> <span class="p">}</span> <span class="p">}</span>

    <span class="n">it</span> <span class="s1">'expects a hash of kits grouped by variants'</span> <span class="k">do</span>
      <span class="n">expect</span> <span class="p">{</span> <span class="no">MockInventoryItemCollection</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">to</span> <span class="n">raise_error</span><span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span>

      <span class="n">expect</span> <span class="p">{</span> <span class="no">MockInventoryItemCollection</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">valid_argument</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">to_not</span> <span class="n">raise_error</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">'assigns an array of MockInventoryItems to @active_items'</span> <span class="k">do</span>
      <span class="n">collection</span> <span class="o">=</span> <span class="no">MockInventoryItemCollection</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">valid_argument</span><span class="p">)</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">collection</span><span class="p">.</span><span class="nf">active_items</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_a</span><span class="p">(</span><span class="no">Array</span><span class="p">)</span>
      <span class="n">expect</span><span class="p">(</span>
        <span class="n">collection</span><span class="p">.</span><span class="nf">active_items</span><span class="p">.</span><span class="nf">all?</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
          <span class="n">item</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">MockInventoryItemCollection</span><span class="o">::</span><span class="no">MockInventoryItem</span><span class="p">)</span>
        <span class="k">end</span>
      <span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">'sets the properties on the MockInventoryItems'</span> <span class="k">do</span>
      <span class="n">item</span> <span class="o">=</span> <span class="no">MockInventoryItemCollection</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">valid_argument</span><span class="p">).</span><span class="nf">active_items</span><span class="p">.</span><span class="nf">first</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="nf">variant</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="n">variant</span><span class="p">)</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="nf">count_on_hand_less_backorders</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

<p>I found <code>Struct</code> to be really handy in this case for building data types needed:</p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">MockInventoryItemCollection</span>
  <span class="nc">MockInventoryItem</span> <span class="o">=</span> <span class="no">Struct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:variant</span><span class="p">,</span> <span class="ss">:count_on_hand_less_backorders</span><span class="p">)</span>
  <span class="kp">attr_accessor</span> <span class="ss">:active_items</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="nb">fail</span> <span class="no">ArgumentError</span> <span class="k">unless</span> <span class="n">valid_argument</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">active_items</span> <span class="o">=</span> <span class="n">group</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span> <span class="no">MockInventoryItem</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="nf">length</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">valid_argument</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="k">return</span> <span class="kp">false</span> <span class="k">unless</span> <span class="n">arg</span><span class="p">.</span><span class="nf">try</span><span class="p">(</span><span class="ss">:is_a?</span><span class="p">,</span> <span class="no">Hash</span><span class="p">)</span>
    <span class="k">return</span> <span class="kp">false</span> <span class="k">unless</span> <span class="n">arg</span><span class="p">.</span><span class="nf">keys</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">is_a?</span> <span class="no">Product</span><span class="o">::</span><span class="no">Variant</span>
    <span class="k">return</span> <span class="kp">false</span> <span class="k">unless</span> <span class="n">arg</span><span class="p">.</span><span class="nf">values</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">is_a?</span> <span class="no">Array</span>
    <span class="n">arg</span><span class="p">.</span><span class="nf">values</span><span class="p">.</span><span class="nf">first</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">is_a?</span> <span class="no">Kit</span><span class="o">::</span><span class="no">Placement</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

<p>You can see here that the implementation of <code>MockInventoryItemCollection</code> and <code>MockInventoryItemCollection::MockInventoryItem</code> really is just a simple collection of data types that are tailored to adapt to an existing interface. The meat of the problem was taken care of by passing the results of <code>KitsLocation#group_by_variants</code> into the initializer of <code>MockInventoryItemCollection</code></p>

    </div>

    <aside>
      <h2>Recent Articles</h2>
      <ol>
          <li><a href="../../07/29/delegating-concern.html">Delegating Concern</a> <span>Jul 29</span></li>
          <li><a href="../../07/07/validating-acyclic-graphs.html">Validating acyclic graphs</a> <span>Jul  7</span></li>
          <li><a href="../20/rails-broke-ngrok.html">Rails 4.2 broke Ngrok</a> <span>May 20</span></li>
          <li><a href="virtual-inventory-location.html">Virtual Inventory Location</a> <span>May 18</span></li>
          <li><a href="../15/generic-devise-layout-lookup.html">Generic Devise Layout Lookup</a> <span>May 15</span></li>
          <li><a href="../13/broken-promises.html">Broken Promises</a> <span>May 13</span></li>
          <li><a href="../06/find-ifnone.html">Enumerable#find ifnone</a> <span>May  6</span></li>
          <li><a href="../05/delegation.html">Delegation</a> <span>May  5</span></li>
          <li><a href="../04/class-extraction.html">Class Extraction</a> <span>May  4</span></li>
      </ol>
    </aside>
  </body>
</html>
