<!doctype html>
<html>
  <head>
    <link href="../../../stylesheets/all-bdf2e668.css" rel="stylesheet" type="text/css" />
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>Blog Title - Class Extraction</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
  </head>
  <body>

    <div id="main" role="main">
      <article>
          <h1>Class Extraction</h1>
        <p>As time passes on a project, some classes have a tendency accumulate too many
responsibilities. Take the following, simplified for example:</p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre>
<span class="k">class</span> <span class="nc">WidgetKit</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">total</span>
    <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">end</span>

  <span class="k">def</span> <span class="nf">multi_type?</span>
    <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">end</span>

  <span class="k">def</span> <span class="nf">single_type?</span>
    <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">end</span>

  <span class="k">def</span> <span class="nf">more_widgets_allowed?</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">end</span>

  <span class="k">def</span> <span class="nf">add_widget</span><span class="p">(</span><span class="n">widget_kit_widget</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">end</span>
<span class="k">end</span>

</pre></td></tr></tbody></table>
</div>

<p>Multiple methods are concerned with type issues. We can extract related
methods into their own class which holds a reference to the shopping widget_kit:</p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre>
<span class="k">class</span> <span class="nc">WidgetTypeManager</span>
  <span class="kp">attr_accessor</span> <span class="ss">:widget_kit</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">widget_kit</span><span class="p">)</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">widget_kit</span> <span class="o">=</span> <span class="n">widget_kit</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">multi_type?</span>
    <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">end</span>

  <span class="k">def</span> <span class="nf">single_type?</span>
    <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">end</span>
<span class="k">end</span>

</pre></td></tr></tbody></table>
</div>

<p>Then we can delegate to the new class without affecting the rest of the system:</p>
<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></td><td class="code"><pre>
<span class="k">class</span> <span class="nc">WidgetKit</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">delegate</span> <span class="ss">:multi_type?</span><span class="p">,</span> <span class="ss">:single_type?</span>
           <span class="ss">to: :widget_type_manager</span>

  <span class="k">def</span> <span class="nf">total</span>
    <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">end</span>

  <span class="k">def</span> <span class="nf">more_widgets_allowed?</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">end</span>

  <span class="k">def</span> <span class="nf">add_widget</span><span class="p">(</span><span class="n">widget_kit_widget</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">widget_type_manager</span>
    <span class="vi">@widget_type_manager</span> <span class="o">||=</span> <span class="no">WidgetTypeManager</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

</pre></td></tr></tbody></table>
</div>

<p>This is a good first step to decoupling the type concern altogether.</p>

      </article>
    </div>

    <aside>
      <div class="line-behind-text"><h6 class="er_toc_tag" id="er-toc-id-1">Recent Articles</h6></div>
      <ol>
          <li><a href="../../07/07/validating-acyclic-graphs.html">Validating acyclic graphs</a> <span>Jul  7</span></li>
          <li><a href="../20/rails-broke-ngrok.html">Rails 4.2 broke Ngrok</a> <span>May 20</span></li>
          <li><a href="../18/virtual-inventory-location.html">Virtual Inventory Location</a> <span>May 18</span></li>
          <li><a href="../15/generic-devise-layout-lookup.html">Generic Devise Layout Lookup</a> <span>May 15</span></li>
          <li><a href="../13/broken-promises.html">Broken Promises</a> <span>May 13</span></li>
          <li><a href="../06/find-ifnone.html">Enumerable#find ifnone</a> <span>May  6</span></li>
          <li><a href="../05/delegation.html">Delegation</a> <span>May  5</span></li>
          <li><a href="class-extraction.html">Class Extraction</a> <span>May  4</span></li>
      </ol>
    </aside>
  </body>
</html>
